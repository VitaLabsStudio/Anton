# Risk Profile: Story 1.5: Reddit API Authentication

**Date**: 2025-12-04  
**Reviewer**: Quinn (Test Architect)  
**Status**: Re-assessed & Resolved

## 1. Executive Summary

Re-review confirms Story 1.5 now implements all critical and high-risk mitigations described in the architecture review. The new Reddit auth module, gitleaks coverage, non-blocking rate limiter, circuit breaker, and subreddit approval guard have been exercised via `pnpm --filter @antone/backend test` (72 vitest cases) plus manual code inspection. The previously fatal risks (SEC-001, TECH-001, OPS-001, BUS-001, TECH-002) are now either resolved or controlled.

The only remaining risk is procedural: approving writes still depends on the forthcoming Story 1.8 workflow (BUS-002). Until that workflow lands, the service defaults to `REQUIRE_APPROVAL=true`, which prevents unauthorized writes. This risk is low probability and can be closed once Story 1.8 is released.

## 2. Risk Register

| Risk ID | Description | Current Status | Notes |
| :--- | :--- | :--- | :--- |
| **SEC-001** | Leaked Reddit refresh token | **Mitigated** | `backend/src/platforms/reddit/auth.ts` validates credentials, masks logs, and `.gitleaks.toml` plus `.env.example` document detection and rotation. |
| **TECH-001** | Inefficient multi-subreddit search | **Mitigated** | `searchSubreddits` now joins approved names into one Snoowrap call while logging results; tests confirm single read call. |
| **OPS-001** | Blocking rate limiter usage | **Mitigated** | `redditRateLimiter` uses Bottleneck with `scheduleRead`/`scheduleWrite`; there are no `acquire()` calls left anywhere. |
| **BUS-001** | Violating subreddit rules | **Mitigated** | `subreddit-config.ts` enforces an allowlist and validator; `RedditClient` filters requests before hitting Snoowrap. |
| **TECH-002** | Refresh token expiration | **Mitigated** | All API interactions wrap `handleAuthError`, which logs, disables the integration, and rethrows when invalid tokens appear. |
| **BUS-002** | Write operations lacking approval workflow | **Controlled** | `REQUIRE_APPROVAL=true` prevents actual comments until Story 1.8 delivers the workflow. Manual toggling to false is discouraged. |

## 3. Evidence

- `pnpm --filter @antone/backend test` (72 vitest cases across reddit client/config, rate limiter, retry/circuit breaker)
- Manual inspection confirms `/api/reddit/verify` and `/api/reddit/rate-limit-status` expose the correct monitoring data and reflect rate limiter/circuit breaker state.

## 4. Residual Actions

- Track Story 1.8 to implement the approval workflow so that write operations can flip `REQUIRE_APPROVAL` without exposing the account to accidental posts.
- Continue monitoring `REDDIT_ENABLED` toggles in production logs; the disable-on-failure guard is the failsafe for expired or revoked tokens.

**Confidence**: High  
**Recommended Gate**: PASS (see `docs/qa/gates/1.5-reddit-api-authentication.yml`)
