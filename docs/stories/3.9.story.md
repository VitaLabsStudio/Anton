# Story 3.9: Controlled Assertiveness Protocol

## Status: Draft

## Story

**As a** the system,  
**I want** to politely correct misinformation when detected,  
**so that** I provide factual education without appearing argumentative.

## Acceptance Criteria

1. Misinformation detection at `@backend/analysis/misinformation-detector.ts`
2. Common myths cataloged: "hair of the dog", "greasy food cures", unproven remedies
3. Detection uses DeepSeek to classify if post contains misinformation
4. If myth detected AND SSS ≥0.55: Generate Myth-bust archetype reply
5. Circuit-breaker rules enforced:
   - Max 2 replies per thread (no extended arguments)
   - Exit on escalation keywords ("bot", "shill", "scam", profanity)
   - Third-party hostility triggers immediate disengage
6. Assertive replies tagged with "override" flag (prevents self-deletion on minor pushback)
7. Factual claims sourced from Claims Library with citation links
8. Unit tests validate myth detection accuracy (>85% precision)
9. Manual review queue flags all Controlled Assertiveness posts

---

## Tasks / Subtasks

- [ ] **Task 1: Create Misinformation Detector** (AC: 1, 2, 3)
  - [ ] Create `backend/src/analysis/misinformation-detector.ts`
  - [ ] Define common myths database
  - [ ] Implement detectMisinformation(content)
  - [ ] Use DeepSeek for classification
  - [ ] Return myth type and confidence

- [ ] **Task 2: Catalog Common Myths** (AC: 2)
  - [ ] "Hair of the dog" myth
  - [ ] "Greasy food absorbs alcohol" myth
  - [ ] "Coffee sobers you up" myth
  - [ ] "Activated charcoal cures" myth
  - [ ] Add to misinformation database

- [ ] **Task 3: Implement Myth-bust Trigger** (AC: 4)
  - [ ] Check myth detected AND SSS ≥0.55
  - [ ] Force MYTHBUST archetype
  - [ ] Set override flag

- [ ] **Task 4: Implement Circuit-breaker Rules** (AC: 5)
  - [ ] Track replies per thread
  - [ ] Max 2 per thread
  - [ ] Detect escalation keywords
  - [ ] Detect third-party hostility
  - [ ] Exit immediately if triggered

- [ ] **Task 5: Add Override Flag** (AC: 6)
  - [ ] Tag reply with override flag
  - [ ] Prevents auto-deletion (Story 3.7)
  - [ ] Allows minor pushback

- [ ] **Task 6: Source Claims** (AC: 7)
  - [ ] Use Claims Library for facts
  - [ ] Add citation links
  - [ ] Ensure compliance

- [ ] **Task 7: Create Manual Review Queue** (AC: 9)
  - [ ] Flag all MYTHBUST replies for review
  - [ ] Dashboard shows flagged replies

- [ ] **Task 8: Write Unit Tests** (AC: 8)
  - [ ] Test myth detection
  - [ ] Test >85% precision
  - [ ] Test circuit-breaker rules

---

## Dev Notes

### Misinformation Detector Implementation
```typescript
// backend/src/analysis/misinformation-detector.ts

import { DeepSeekClient } from '../clients/deepseek';
import { logger } from '../utils/logger';

interface MythResult {
  detected: boolean;
  mythType: string | null;
  confidence: number;
  reasoning: string;
}

const COMMON_MYTHS = [
  {
    myth: 'hair_of_the_dog',
    keywords: ['hair of the dog', 'drink more alcohol'],
    factCheck: 'Drinking more alcohol delays recovery, doesn\'t cure it',
  },
  {
    myth: 'greasy_food',
    keywords: ['greasy food absorbs', 'eat greasy'],
    factCheck: 'Greasy food doesn\'t absorb alcohol already in your system',
  },
  {
    myth: 'coffee_sobers',
    keywords: ['coffee sobers', 'caffeine helps'],
    factCheck: 'Caffeine doesn\'t eliminate alcohol from your system',
  },
  {
    myth: 'activated_charcoal',
    keywords: ['activated charcoal', 'charcoal cures'],
    factCheck: 'Activated charcoal doesn\'t bind to alcohol already absorbed',
  },
];

export class MisinformationDetector {
  private deepseek: DeepSeekClient;

  constructor() {
    this.deepseek = new DeepSeekClient();
  }

  async detectMisinformation(content: string): Promise<MythResult> {
    // Quick keyword check
    for (const myth of COMMON_MYTHS) {
      for (const keyword of myth.keywords) {
        if (content.toLowerCase().includes(keyword)) {
          // Verify with DeepSeek
          return this.verifyMyth(content, myth);
        }
      }
    }

    return {
      detected: false,
      mythType: null,
      confidence: 1.0,
      reasoning: 'No misinformation detected',
    };
  }

  private async verifyMyth(content: string, myth: any): Promise<MythResult> {
    const prompt = `
Is this post promoting the myth that "${myth.keywords[0]}"?

POST: "${content}"

MYTH FACT CHECK: ${myth.factCheck}

Respond with JSON:
{
  "isMisinformation": true|false,
  "confidence": 0.0-1.0,
  "reasoning": "brief explanation"
}`;

    try {
      const result = await this.deepseek.generate(prompt, { temperature: 0.2 });
      const parsed = JSON.parse(result.content);

      return {
        detected: parsed.isMisinformation,
        mythType: parsed.isMisinformation ? myth.myth : null,
        confidence: parsed.confidence,
        reasoning: parsed.reasoning,
      };
    } catch (error) {
      logger.error('Misinformation verification failed', { error });
      return {
        detected: false,
        mythType: null,
        confidence: 0,
        reasoning: 'Verification failed',
      };
    }
  }
}

export const misinformationDetector = new MisinformationDetector();
```

### File Structure
```
backend/src/
└── analysis/
    ├── misinformation-detector.ts  # THIS STORY
    └── safety-protocol.ts
```

---

## Testing

### Test File Location
- `backend/tests/unit/analysis/misinformation-detector.test.ts`

### Testing Standards
- Test myth detection
- Test DeepSeek classification
- Test >85% precision

### Story-Specific Testing Requirements
1. Common myths detected correctly
2. Myth-bust triggered when SSS ≥0.55
3. Override flag prevents auto-deletion
4. Circuit-breaker limits replies
5. Citations included
6. Manual review queue works

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-01 | 1.0 | Initial story draft | Bob (SM Agent) |

---

## Dev Agent Record
*To be filled by Dev Agent*

---

## QA Results
*To be filled by QA Agent*













