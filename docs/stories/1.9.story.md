# Story 1.9: Reddit Community Building (r/VitaWellness)

## Status: Draft

## Story

**As** the system,  
**I want** to create and manage r/VitaWellness as a long-term community hub while prioritizing engagement in existing large subreddits,  
**so that** Vita builds organic Reddit presence where users already congregate, with owned community as future growth channel.

## Acceptance Criteria

1. **Subreddit Creation**:
   - Create r/VitaWellness with clear rules, sidebar info, and branding
   - Subreddit description: "Science-backed wellness tips, hangover help, and transdermal patch education. Community-first, spam-free zone."
   - Rules posted: No spam, Be respectful, Science-backed advice only, No medical diagnosis
   - Moderator: u/antone_vita (bot account) + human backup moderator

2. **Content Seeding Strategy** (First 30 days):
   - **Focus 80% on existing subreddits** (r/AskReddit, r/LifeProTips, r/hangover, r/college)
   - **Allocate 20% to r/VitaWellness** content creation
   - Post educational content to r/VitaWellness: "The Science of Hangovers", "Transdermal vs Oral Supplements", "Hydration Myths Debunked"
   - Cross-promotion (subtle): Occasionally link helpful r/VitaWellness posts when relevant in other subs

3. **AMA Strategy** (Monthly):
   - Monthly "Ask About Hangover Science" threads in r/VitaWellness
   - Promote AMA in relevant subreddits 24 hours before
   - Human oversight: PM reviews AMA responses before posting

4. **Value-First Content Library**:
   - Create 10 evergreen educational posts (no product mentions)
   - Topics: Alcohol metabolism, NAD+ depletion, hydration science, vitamin cofactors, prevention strategies
   - Post quality: 500-800 words, cited sources

5. **Moderator Outreach** (Existing Subreddits):
   - Reach out to r/hangover moderators for collaboration
   - Offer value: Well-researched content, no spam, transparent Vita affiliation
   - Goal: Get approved contributor status or wiki collaboration

6. **Community Growth Metrics**:
   - r/VitaWellness subscribers: Target 100 in first 30 days, 500 in 90 days
   - Engagement rate: >5% of subscribers actively commenting
   - Retention: Subscribers stay subscribed (low churn)

7. **Engagement Priority**:
   - **Existing large subreddits remain primary focus** (70-80% of Reddit activity)
   - r/VitaWellness is long-term investment, NOT immediate priority
   - Only shift focus to r/VitaWellness once it reaches 1,000+ subscribers organically

8. **Content Posting Service**:
   - Automated service at `@backend/services/reddit-content-poster.ts`
   - Schedule: 1 educational post per week to r/VitaWellness
   - Manual approval: Human reviews all r/VitaWellness posts before publishing

9. Dashboard tracking:
   - r/VitaWellness growth: Subscribers, posts, comments, engagement rate
   - Cross-promotion effectiveness: Traffic from other subs to r/VitaWellness
   - Moderator relationship status: Which subs we have positive relationships with

10. Integration test: Create test subreddit, post content, verify functionality

---

## Tasks / Subtasks

- [ ] **Task 1: Create Content Library** (AC: 4)
  - [ ] Create `backend/src/data/content-library.json`
  - [ ] Write post: "The Science of Hangovers: What Really Happens to Your Body"
  - [ ] Write post: "Transdermal vs Oral Supplements: Absorption Science Explained"
  - [ ] Write post: "Hydration Myths Debunked: What Actually Helps"
  - [ ] Write post: "NAD+ Depletion: Why Hangovers Get Worse With Age"
  - [ ] Write post: "Prevention Strategies: Evidence-Based Pre-Drinking Tips"
  - [ ] Write post: "Vitamin Cofactors: The Science of Alcohol Metabolism"
  - [ ] Write post: "B-Vitamins and Hangovers: What the Research Says"
  - [ ] Write post: "Electrolyte Balance: More Than Just Water"
  - [ ] Write post: "Recovery Timeline: Hour-by-Hour What Your Body Does"
  - [ ] Write post: "Common Hangover Cures: Fact vs Fiction"
  - [ ] Each post: 500-800 words, cited sources, no product mentions

- [ ] **Task 2: Create Subreddit Configuration** (AC: 1)
  - [ ] Create `backend/src/data/subreddit-config.json`
  - [ ] Define subreddit description
  - [ ] Define community rules (5 rules)
  - [ ] Define sidebar content
  - [ ] Define flair options

- [ ] **Task 3: Create Reddit Content Poster Service** (AC: 8)
  - [ ] Create `backend/src/services/reddit-content-poster.ts`
  - [ ] Implement content scheduling (1 post/week)
  - [ ] Implement draft queue for human review
  - [ ] Implement posting after approval
  - [ ] Track posted content to avoid duplicates
  - [ ] Log posting metrics

- [ ] **Task 4: Implement Engagement Priority Logic** (AC: 7)
  - [ ] Track activity distribution (80% external, 20% r/VitaWellness)
  - [ ] Prioritize high-traffic subreddits for engagement
  - [ ] Calculate engagement ratios
  - [ ] Log priority decisions

- [ ] **Task 5: Create Community Metrics Service** (AC: 6, 9)
  - [ ] Create `backend/src/services/community-metrics.ts`
  - [ ] Track subscriber count via Reddit API
  - [ ] Track post count and engagement
  - [ ] Calculate engagement rate
  - [ ] Calculate retention metrics

- [ ] **Task 6: Create Dashboard API Endpoints** (AC: 9)
  - [ ] Create `backend/src/api/routes/community.ts`
  - [ ] Implement `GET /api/community/metrics`
  - [ ] Implement `GET /api/community/content-queue`
  - [ ] Implement `POST /api/community/content/:id/approve`
  - [ ] Implement `POST /api/community/content/:id/reject`

- [ ] **Task 7: Create AMA Scheduler** (AC: 3)
  - [ ] Create `backend/src/services/ama-scheduler.ts`
  - [ ] Schedule monthly AMA threads
  - [ ] Create promotion posts 24 hours before
  - [ ] Queue AMA responses for human review

- [ ] **Task 8: Create Moderator Outreach Tracker** (AC: 5)
  - [ ] Create `backend/src/data/moderator-outreach.json`
  - [ ] Track outreach attempts per subreddit
  - [ ] Track response status
  - [ ] Track relationship quality

- [ ] **Task 9: Implement Subreddit Setup Script** (AC: 1)
  - [ ] Create `scripts/setup-subreddit.ts`
  - [ ] Create subreddit via Reddit API
  - [ ] Set description and rules
  - [ ] Configure sidebar
  - [ ] Add initial welcome post

- [ ] **Task 10: Write Integration Tests** (AC: 10)
  - [ ] Test content poster with mock Reddit API
  - [ ] Test metrics collection
  - [ ] Test approval workflow
  - [ ] Test scheduling logic

---

## Dev Notes

### Previous Story Insights
- Story 1.5 must be complete (Reddit client)
- Story 1.7 must be complete (karma tracking)
- Reuse RedditClient for all API calls

### Content Library Structure
```json
// backend/src/data/content-library.json
{
  "version": "1.0",
  "posts": [
    {
      "id": "science-of-hangovers",
      "title": "The Science of Hangovers: What Really Happens to Your Body",
      "content": "...(500-800 words)...",
      "sources": [
        "https://pubmed.ncbi.nlm.nih.gov/...",
        "https://www.ncbi.nlm.nih.gov/..."
      ],
      "tags": ["science", "education", "hangover-basics"],
      "productMention": false,
      "lastPosted": null
    }
    // ... 9 more posts
  ]
}
```

### Reddit Content Poster Service
```typescript
// backend/src/services/reddit-content-poster.ts

import { RedditClient } from '../platforms/reddit/client';
import { prisma } from '../db';
import { logger } from '../utils/logger';
import contentLibrary from '../data/content-library.json';

interface ContentPost {
  id: string;
  title: string;
  content: string;
  sources: string[];
  tags: string[];
  productMention: boolean;
  lastPosted: string | null;
}

interface DraftPost {
  id: string;
  contentId: string;
  subreddit: string;
  title: string;
  content: string;
  status: 'draft' | 'approved' | 'rejected' | 'posted';
  createdAt: Date;
  approvedBy?: string;
  postedAt?: Date;
}

export class RedditContentPoster {
  private reddit: RedditClient;
  private targetSubreddit: string = 'VitaWellness';
  
  constructor() {
    this.reddit = new RedditClient();
  }

  async scheduleWeeklyPost(): Promise<DraftPost | null> {
    // Get next post from content library
    const posts = contentLibrary.posts as ContentPost[];
    const availablePost = posts.find(p => 
      !p.lastPosted || this.daysSince(p.lastPosted) > 30
    );

    if (!availablePost) {
      logger.warn('No available posts in content library');
      return null;
    }

    // Create draft for human review
    const draft: DraftPost = {
      id: `draft-${Date.now()}`,
      contentId: availablePost.id,
      subreddit: this.targetSubreddit,
      title: availablePost.title,
      content: this.formatPost(availablePost),
      status: 'draft',
      createdAt: new Date(),
    };

    // Save to database
    await this.saveDraft(draft);

    logger.info('Created content draft for review', { 
      contentId: availablePost.id,
      subreddit: this.targetSubreddit,
    });

    return draft;
  }

  async approveAndPost(draftId: string, approvedBy: string): Promise<string> {
    const draft = await this.getDraft(draftId);
    
    if (!draft || draft.status !== 'draft') {
      throw new Error('Draft not found or already processed');
    }

    // Post to Reddit
    const postId = await this.reddit.submitSelfPost(
      this.targetSubreddit,
      draft.title,
      draft.content
    );

    // Update draft status
    draft.status = 'posted';
    draft.approvedBy = approvedBy;
    draft.postedAt = new Date();
    await this.updateDraft(draft);

    // Update content library last posted
    await this.markContentAsPosted(draft.contentId);

    logger.info('Posted approved content to Reddit', { 
      draftId,
      postId,
      subreddit: this.targetSubreddit,
    });

    return postId;
  }

  private formatPost(post: ContentPost): string {
    let formatted = post.content;
    
    // Add sources section
    if (post.sources.length > 0) {
      formatted += '\n\n---\n\n**Sources:**\n';
      post.sources.forEach((source, i) => {
        formatted += `${i + 1}. ${source}\n`;
      });
    }

    // Add community signature
    formatted += '\n\n---\n\n*Posted by the r/VitaWellness mod team. Questions? Drop a comment!*';

    return formatted;
  }

  private daysSince(dateStr: string): number {
    const date = new Date(dateStr);
    return (Date.now() - date.getTime()) / (1000 * 60 * 60 * 24);
  }

  // Database operations
  private async saveDraft(draft: DraftPost): Promise<void> { /* ... */ }
  private async getDraft(id: string): Promise<DraftPost | null> { /* ... */ }
  private async updateDraft(draft: DraftPost): Promise<void> { /* ... */ }
  private async markContentAsPosted(contentId: string): Promise<void> { /* ... */ }
}
```

### Community Metrics Service
```typescript
// backend/src/services/community-metrics.ts

import { RedditClient } from '../platforms/reddit/client';
import { logger } from '../utils/logger';

interface CommunityMetrics {
  subscribers: number;
  activeUsers: number;
  totalPosts: number;
  totalComments: number;
  engagementRate: number; // comments / (subscribers * posts)
  growthRate: number; // % change over period
  lastUpdated: Date;
}

export class CommunityMetricsService {
  private reddit: RedditClient;
  private subreddit: string = 'VitaWellness';

  constructor() {
    this.reddit = new RedditClient();
  }

  async getMetrics(): Promise<CommunityMetrics> {
    const subredditInfo = await this.reddit.getSubredditInfo(this.subreddit);
    const recentPosts = await this.reddit.getSubredditPosts(this.subreddit, 50);

    const totalComments = recentPosts.reduce((sum, post) => 
      sum + (post.num_comments || 0), 0
    );

    const engagementRate = recentPosts.length > 0 && subredditInfo.subscribers > 0
      ? (totalComments / (subredditInfo.subscribers * recentPosts.length)) * 100
      : 0;

    return {
      subscribers: subredditInfo.subscribers,
      activeUsers: subredditInfo.active_user_count || 0,
      totalPosts: recentPosts.length,
      totalComments,
      engagementRate,
      growthRate: await this.calculateGrowthRate(),
      lastUpdated: new Date(),
    };
  }

  private async calculateGrowthRate(): Promise<number> {
    // Compare current to previous period
    // Implementation depends on historical data tracking
    return 0;
  }
}
```

### Subreddit Configuration
```json
// backend/src/data/subreddit-config.json
{
  "name": "VitaWellness",
  "title": "Vita Wellness - Science-Based Hangover & Wellness Tips",
  "description": "Science-backed wellness tips, hangover help, and transdermal patch education. Community-first, spam-free zone.",
  "sidebar": "Welcome to r/VitaWellness!\n\nWe're dedicated to science-based wellness discussions, with a focus on hangover prevention and recovery.\n\n**What we discuss:**\n- Hangover science and prevention\n- Supplement education\n- Transdermal delivery technology\n- General wellness tips\n\n**Community Guidelines:**\n1. Be respectful to all members\n2. Back claims with science\n3. No spam or self-promotion\n4. No medical diagnosis\n5. Keep it constructive",
  "rules": [
    {
      "title": "No Spam or Self-Promotion",
      "description": "This community is for genuine discussion, not advertising."
    },
    {
      "title": "Be Respectful",
      "description": "Treat all members with respect. No personal attacks or harassment."
    },
    {
      "title": "Science-Backed Advice Only",
      "description": "Claims should be supported by scientific evidence. Cite sources when possible."
    },
    {
      "title": "No Medical Diagnosis",
      "description": "We're not doctors. Don't ask for or provide medical diagnoses. See a professional."
    },
    {
      "title": "Stay On Topic",
      "description": "Keep discussions relevant to wellness, hangovers, and related topics."
    }
  ],
  "flairs": [
    "Science üî¨",
    "Discussion üí¨",
    "Question ‚ùì",
    "Tips & Tricks üí°",
    "Success Story üéâ"
  ]
}
```

### File Structure
```
backend/src/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ content-library.json      # 10 evergreen educational posts
‚îÇ   ‚îú‚îÄ‚îÄ subreddit-config.json     # r/VitaWellness configuration
‚îÇ   ‚îî‚îÄ‚îÄ moderator-outreach.json   # Outreach tracking
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ reddit-content-poster.ts  # Content scheduling & posting
‚îÇ   ‚îú‚îÄ‚îÄ community-metrics.ts      # Community analytics
‚îÇ   ‚îî‚îÄ‚îÄ ama-scheduler.ts          # AMA management
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îî‚îÄ‚îÄ community.ts          # Community API endpoints

scripts/
‚îî‚îÄ‚îÄ setup-subreddit.ts            # Subreddit creation script
```

---

## Testing

### Test File Location
- `backend/tests/unit/services/reddit-content-poster.test.ts`
- `backend/tests/unit/services/community-metrics.test.ts`
- `backend/tests/integration/api/community.test.ts`

### Testing Standards
- Mock Reddit API responses
- Test content scheduling logic
- Test approval workflow
- Test metrics calculation

### Story-Specific Testing Requirements
1. Content poster schedules weekly posts
2. Draft approval workflow works
3. Metrics collected correctly
4. Dashboard API returns expected data
5. No duplicate posts within 30 days

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-01 | 1.0 | Initial story draft | Bob (SM Agent) |

---

## Dev Agent Record

### Agent Model Used
*To be filled by Dev Agent*

### Debug Log References
*To be filled by Dev Agent*

### Completion Notes List
*To be filled by Dev Agent*

### File List
*To be filled by Dev Agent*

---

## QA Results
*To be filled by QA Agent*

