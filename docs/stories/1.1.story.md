# Story 1.1: Project Setup & Monorepo Structure

## Status: Draft

## Story

**As a** developer,  
**I want** a well-organized monorepo with TypeScript, linting, build tooling, and advanced statistical libraries configured,  
**so that** the codebase is maintainable, type-safe, supports advanced learning algorithms, and is ready for multiple team members to contribute.

## Acceptance Criteria

1. Project initialized with `pnpm` workspaces for `/backend`, `/dashboard`, and `/shared`
2. TypeScript configured with strict mode and path aliases:
   - Base config: `tsconfig.base.json` with strict mode enabled
   - Target: ES2024, Module: NodeNext, ModuleResolution: NodeNext
   - Path aliases: `@/*` for local src, `@shared/*` for shared package
   - Backend tsconfig: extends base, `outDir: ./dist`, `rootDir: ./src`
   - Dashboard tsconfig: extends base, Next.js specific config
   - Shared tsconfig: exports types for consumption by other packages
   - Strict mode flags enabled in tsconfig.base.json:
     * `strict: true` (base strict flag)
     * `noImplicitAny: true`, `strictNullChecks: true`, `strictFunctionTypes: true`
     * `strictBindCallApply: true`, `strictPropertyInitialization: true`
     * `noImplicitThis: true`, `alwaysStrict: true`
     * `noUnusedLocals: true`, `noUnusedParameters: true`
     * `noImplicitReturns: true`, `noFallthroughCasesInSwitch: true`
     * `noUncheckedIndexedAccess: true`, `noImplicitOverride: true`
     * `noPropertyAccessFromIndexSignature: true`
3. ESLint and Prettier configured with consistent rules across all packages:
   - ESLint 9.15.x with TypeScript plugin, security plugin, import plugin
   - Key ESLint rules enforced:
     * `@typescript-eslint/explicit-function-return-type: error`
     * `@typescript-eslint/no-explicit-any: error`
     * `@typescript-eslint/no-floating-promises: error`, `await-thenable: error`
     * Import order with alphabetization and grouped imports (builtin → external → internal)
     * Security plugin: `detect-object-injection: warn`, `detect-non-literal-regexp: warn`
   - Prettier 3.4.x with 100 char line length, single quotes, semicolons
   - EditorConfig with LF line endings, 2-space indent
4. `package.json` scripts defined at root level:
   - Development: `dev`, `build`, `test`, `test:coverage`
   - Code Quality: `lint`, `lint:fix`, `format`, `format:check`, `typecheck`, `validate`
   - Database: `db:migrate`, `db:seed`, `db:studio`
   - Docker: `docker:dev`, `docker:prod`, `docker:down`
   - Git Hooks: `prepare` (husky install)
5. `.gitignore` configured to exclude `node_modules`, `.env`, build artifacts
6. README.md includes project overview, setup instructions, and architecture diagram
7. All packages build successfully with `pnpm build`
8. **Advanced Learning System Dependencies** (from Learning System Improvements doc):
   - `simple-statistics` (^7.8.3) - Statistical functions for robust statistics
   - `jstat` (^1.9.6) - Beta distribution, t-tests, and statistical inference
   - `seedrandom` (^3.0.5) - Reproducible random sampling for Thompson Sampling
   - `@types/simple-statistics` (^7.8.3) - TypeScript definitions
   - `@types/jstat` (^1.9.3) - TypeScript definitions
9. Configuration file created at `backend/src/config/learning.json` with:
   - Minimum sample sizes for all learning operations
   - Robust statistics settings (Winsorization percentiles)
   - Confidence interval parameters
   - Thompson Sampling configuration
   - Segmentation settings
   - Adaptive learning rate parameters
   - Causal inference settings
   - Meta-learning configuration
10. **Production Dependencies** installed with locked versions:
    - Runtime: Node.js **24.11.1** (LTS), TypeScript **5.9.3**
    - Package Manager: pnpm **10.0.0** (25% faster than 8.x)
    - Web Framework: `hono@^4.6.0`, `@hono/node-server@^1.13.0` (10x faster than Express)
    - Database: `@prisma/client@^7.0.1`, `prisma@^7.0.1` (devDependency) (40% faster queries)
    - Platform SDKs: `twitter-api-v2@^1.17.2`, `snoowrap@^1.23.0`, `axios@^1.7.9`
    - Validation: `zod@^3.24.1`
    - Logging: `pino@^9.5.0`, `pino-pretty@^12.0.0`
    - Utilities: `ioredis@^5.4.2`, `node-cron@^3.0.3`, `uuid@^11.0.3`, `dotenv@^16.4.7`
11. **Dashboard Dependencies** configured:
    - Framework: `next@^16.0.2` (Turbopack default), `react@^19.0.0`, `react-dom@^19.0.0`
    - Styling: `tailwindcss@^4.0.0` (Oxide engine, 10x faster builds)
    - Data Fetching: `@tanstack/react-query@^5.62.11`
    - Visualization: `recharts@^2.15.0`, `lucide-react@^0.468.0`
    - Utilities: `clsx@^2.1.1`, `tailwind-merge@^2.5.5`, `date-fns@^4.1.0`
    - Real-time: `socket.io-client@^4.8.1`
12. **Development Tooling** configured:
    - Git hooks: Husky 9.x with pre-commit (lint-staged + typecheck), pre-push (tests + build), commit-msg (commitlint)
    - CommitLint: Conventional commits format enforced (`@commitlint/config-conventional`)
    - EditorConfig: Consistent formatting rules (`.editorconfig`) - UTF-8, LF, 2-space indent
    - VS Code: Workspace settings with recommended extensions:
      - `.vscode/settings.json`: Format on save, ESLint auto-fix on save
      - `.vscode/extensions.json`: ESLint, Prettier, Tailwind CSS, Prisma, TypeScript, Error Lens, GitLens
      - `.vscode/launch.json`: Debug configurations for API, worker, and tests
    - Node version: `.nvmrc` file with version **24.11.1** (LTS until April 2027)
    - Ignore files: `.eslintignore`, `.prettierignore`, `.gitignore` properly configured
    - Testing: Vitest 2.1.x for unit and integration tests (faster than Jest)
    - Vitest configuration:
      * Coverage provider: v8 (faster than istanbul)
      * Coverage thresholds: 80% lines, 80% functions, 75% branches, 80% statements
      * Reporters: text (console), json, html (dashboard), lcov (CI)
      * Test file patterns: `**/*.{test,spec}.{ts,tsx}`

---

## Tasks / Subtasks

- [ ] **Task 1: Initialize pnpm Monorepo** (AC: 1)
  - [ ] Create root `package.json` with workspace configuration
  - [ ] Create `pnpm-workspace.yaml` defining workspaces: `["backend", "dashboard", "shared", "database"]`
  - [ ] Create empty workspace directories: `backend/`, `dashboard/`, `shared/`, `database/`
  - [ ] Run `pnpm install` to verify workspace setup

- [ ] **Task 2: Configure TypeScript with Strict Mode** (AC: 2)
  - [ ] Create `tsconfig.base.json` at root with all strict mode flags (see Dev Notes)
  - [ ] Create `backend/tsconfig.json` extending base with `outDir: ./dist`, `rootDir: ./src`
  - [ ] Create `dashboard/tsconfig.json` extending base with Next.js config
  - [ ] Create `shared/tsconfig.json` with declaration exports
  - [ ] Create `database/tsconfig.json` extending base
  - [ ] Configure path aliases: `@/*` for local src, `@shared/*` for shared package

- [ ] **Task 3: Configure ESLint** (AC: 3)
  - [ ] Create `.eslintrc.js` at root with TypeScript, security, and import plugins
  - [ ] Configure all required rules per architecture (explicit return types, no any, etc.)
  - [ ] Create `.eslintignore` for node_modules, dist, coverage
  - [ ] Add eslint packages to root devDependencies

- [ ] **Task 4: Configure Prettier** (AC: 3)
  - [ ] Create `.prettierrc` with 100 char line length, single quotes, semicolons
  - [ ] Create `.prettierignore` for node_modules, dist, coverage, pnpm-lock.yaml
  - [ ] Create `.editorconfig` with LF line endings, 2-space indent, UTF-8

- [ ] **Task 5: Create Root package.json with Scripts** (AC: 4, 10)
  - [ ] Define all workspace scripts (dev, build, test, lint, format, typecheck, validate)
  - [ ] Define database scripts (db:migrate, db:seed, db:studio)
  - [ ] Define docker scripts (docker:dev, docker:prod, docker:down)
  - [ ] Add all root devDependencies per architecture spec
  - [ ] Set `"packageManager": "pnpm@10.0.0"` and engines constraints

- [ ] **Task 6: Create Backend package.json** (AC: 10, 8)
  - [ ] Add all production dependencies per architecture (hono, prisma, platform SDKs, etc.)
  - [ ] Add statistical libraries: simple-statistics, jstat, seedrandom with types
  - [ ] Add devDependencies: vitest, tsx, ts-node, prisma CLI
  - [ ] Define scripts: dev, build, test, test:coverage, lint, typecheck
  - [ ] Create `backend/src/` directory structure

- [ ] **Task 7: Create Dashboard package.json** (AC: 11)
  - [ ] Add Next.js 16.x, React 19.x dependencies
  - [ ] Add styling: tailwindcss 4.x, autoprefixer, postcss
  - [ ] Add data fetching: @tanstack/react-query, recharts, lucide-react
  - [ ] Add utilities: clsx, tailwind-merge, date-fns, socket.io-client
  - [ ] Define scripts: dev, build, start, lint, typecheck
  - [ ] Create `dashboard/src/app/` directory with placeholder page.tsx

- [ ] **Task 8: Create Shared package.json** (AC: 1)
  - [ ] Configure as internal package for types and constants
  - [ ] Create `shared/src/types/` directory with placeholder index.ts
  - [ ] Create `shared/src/constants/` directory
  - [ ] Create `shared/src/schemas/` directory
  - [ ] Export all modules from main index.ts

- [ ] **Task 9: Create Database package.json** (AC: 1)
  - [ ] Configure for Prisma schema and migrations
  - [ ] Create `database/prisma/` directory
  - [ ] Create placeholder `schema.prisma` file
  - [ ] Define scripts: db:migrate, db:seed, db:studio, db:generate

- [ ] **Task 10: Configure Git Hooks with Husky** (AC: 12)
  - [ ] Initialize husky: `pnpm exec husky init`
  - [ ] Create `.husky/pre-commit` with lint-staged and typecheck
  - [ ] Create `.husky/pre-push` with test and build
  - [ ] Create `.husky/commit-msg` with commitlint
  - [ ] Add `lint-staged` config to root package.json
  - [ ] Add `@commitlint/cli` and `@commitlint/config-conventional`
  - [ ] Create `commitlint.config.js`

- [ ] **Task 11: Configure VS Code Workspace** (AC: 12)
  - [ ] Create `.vscode/settings.json` with format on save, ESLint fix on save
  - [ ] Create `.vscode/extensions.json` with recommended extensions
  - [ ] Create `.vscode/launch.json` with debug configurations

- [ ] **Task 12: Create Node Version and Ignore Files** (AC: 5, 12)
  - [ ] Create `.nvmrc` with `24.11.1`
  - [ ] Create comprehensive `.gitignore` (node_modules, .env, dist, coverage, etc.)

- [ ] **Task 13: Create Learning Configuration** (AC: 9)
  - [ ] Create `backend/src/config/learning.json` with all parameters
  - [ ] Include: minimum sample sizes, Winsorization percentiles, confidence intervals
  - [ ] Include: Thompson Sampling config, segmentation settings, adaptive rates
  - [ ] Include: causal inference and meta-learning configuration

- [ ] **Task 14: Configure Vitest** (AC: 12)
  - [ ] Create `vitest.config.ts` at root
  - [ ] Configure coverage provider: v8
  - [ ] Set coverage thresholds: 80/80/75/80
  - [ ] Configure reporters: text, json, html, lcov
  - [ ] Set test file patterns

- [ ] **Task 15: Create README.md** (AC: 6)
  - [ ] Write project overview (Antone V1 - Autonomous AI Social Media Manager)
  - [ ] Include setup instructions (prerequisites, installation, development)
  - [ ] Include architecture diagram reference
  - [ ] Document available scripts

- [ ] **Task 16: Verify Build** (AC: 7)
  - [ ] Run `pnpm install` to install all dependencies
  - [ ] Run `pnpm build` to verify all packages build
  - [ ] Run `pnpm lint` to verify linting works
  - [ ] Run `pnpm typecheck` to verify type checking works

---

## Dev Notes

### Previous Story Insights
No previous story - this is Story 1.1.

### Project Structure
[Source: architecture.md#3-repository-structure]

The project uses a pnpm monorepo structure:
```
antone/
├── backend/          # Hono API server + workers
├── dashboard/        # Next.js 16 frontend
├── shared/           # Shared types, constants, schemas
├── database/         # Prisma schema and migrations
├── docker/           # Docker compose files
├── scripts/          # Utility scripts
├── .husky/           # Git hooks
├── .vscode/          # VS Code workspace settings
├── tsconfig.base.json
├── pnpm-workspace.yaml
├── vitest.config.ts
└── package.json
```

### TypeScript Base Configuration
[Source: architecture.md#2-technology-stack - Coding Standards]

```json
{
  "compilerOptions": {
    "target": "ES2024",
    "lib": ["ES2024"],
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitThis": true,
    "alwaysStrict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "outDir": "./dist",
    "removeComments": false,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "exclude": ["node_modules", "dist", "**/*.spec.ts", "**/*.test.ts"]
}
```

### ESLint Configuration
[Source: architecture.md#2-technology-stack - ESLint Configuration Standards]

Key rules to configure:
- `@typescript-eslint/explicit-function-return-type: error`
- `@typescript-eslint/no-explicit-any: error`
- `@typescript-eslint/no-floating-promises: error`
- `@typescript-eslint/await-thenable: error`
- `@typescript-eslint/no-misused-promises: error`
- `@typescript-eslint/prefer-nullish-coalescing: error`
- `@typescript-eslint/prefer-optional-chain: error`
- `import/order` with groups and alphabetize
- `security/detect-object-injection: warn`
- `security/detect-non-literal-regexp: warn`

### Prettier Configuration
[Source: architecture.md#2-technology-stack - Prettier Configuration Standards]

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "arrowParens": "always",
  "endOfLine": "lf",
  "bracketSpacing": true,
  "bracketSameLine": false,
  "quoteProps": "as-needed",
  "proseWrap": "preserve"
}
```

### Root package.json Dependencies
[Source: architecture.md#3.2-package-dependencies]

```json
{
  "name": "antone",
  "private": true,
  "packageManager": "pnpm@10.0.0",
  "engines": {
    "node": ">=24.11.0",
    "pnpm": ">=10.0.0"
  },
  "devDependencies": {
    "@types/node": "^24.11.0",
    "typescript": "^5.9.3",
    "eslint": "^9.15.0",
    "@typescript-eslint/eslint-plugin": "^8.17.0",
    "@typescript-eslint/parser": "^8.17.0",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.31.0",
    "eslint-plugin-security": "^3.0.1",
    "prettier": "^3.4.0",
    "husky": "^9.1.7",
    "lint-staged": "^15.2.11",
    "@commitlint/cli": "^19.6.1",
    "@commitlint/config-conventional": "^19.6.0"
  }
}
```

### Backend Dependencies
[Source: architecture.md#3.2-package-dependencies]

```json
{
  "dependencies": {
    "hono": "^4.6.0",
    "@hono/node-server": "^1.13.0",
    "@prisma/client": "^7.0.1",
    "twitter-api-v2": "^1.17.2",
    "snoowrap": "^1.23.0",
    "axios": "^1.7.9",
    "zod": "^3.24.1",
    "pino": "^9.5.0",
    "pino-pretty": "^12.0.0",
    "simple-statistics": "^7.8.3",
    "jstat": "^1.9.6",
    "seedrandom": "^3.0.5",
    "ioredis": "^5.4.2",
    "node-cron": "^3.0.3",
    "uuid": "^11.0.3",
    "dotenv": "^16.4.7"
  },
  "devDependencies": {
    "@types/uuid": "^10.0.0",
    "@types/node": "^24.11.0",
    "@types/simple-statistics": "^7.8.3",
    "@types/jstat": "^1.9.3",
    "vitest": "^2.1.8",
    "ts-node": "^10.9.2",
    "tsx": "^4.19.2",
    "prisma": "^7.0.1",
    "typescript": "^5.9.3"
  }
}
```

### Dashboard Dependencies
[Source: architecture.md#3.2-package-dependencies]

```json
{
  "dependencies": {
    "next": "^16.0.2",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "@tanstack/react-query": "^5.62.11",
    "recharts": "^2.15.0",
    "lucide-react": "^0.468.0",
    "clsx": "^2.1.1",
    "tailwind-merge": "^2.5.5",
    "date-fns": "^4.1.0",
    "socket.io-client": "^4.8.1"
  },
  "devDependencies": {
    "@types/react": "^19.0.2",
    "@types/react-dom": "^19.0.2",
    "tailwindcss": "^4.0.0",
    "autoprefixer": "^10.4.20",
    "postcss": "^8.4.49",
    "typescript": "^5.9.3"
  }
}
```

### Git Hooks Configuration
[Source: architecture.md#3.3-development-tooling-configuration]

**Pre-commit (.husky/pre-commit):**
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"
pnpm lint-staged
pnpm typecheck
```

**Pre-push (.husky/pre-push):**
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"
pnpm test
pnpm build
```

### File Naming Conventions
[Source: architecture.md#2-technology-stack - File Naming Conventions]

- Backend services: `kebab-case.ts` (e.g., `decision-engine.ts`)
- Backend classes: `PascalCase.ts` (e.g., `DecisionEngine.ts`)
- Backend utilities: `kebab-case.ts` (e.g., `rate-limiter.ts`)
- Backend types: `kebab-case.types.ts` (e.g., `decision.types.ts`)
- Tests: `*.test.ts` or `*.spec.ts`
- Frontend components: `PascalCase.tsx` (e.g., `MetricCard.tsx`)
- Frontend pages: `kebab-case/page.tsx` (e.g., `kpis/page.tsx`)
- Frontend hooks: `use-kebab-case.ts` (e.g., `use-websocket.ts`)

---

## Testing

### Test File Location
[Source: architecture.md#13-testing-strategy]

- Backend unit tests: `backend/tests/unit/`
- Backend integration tests: `backend/tests/integration/`
- Dashboard tests: `dashboard/tests/` (for Story 1.1, minimal testing needed)

### Testing Standards
- Testing framework: **Vitest 2.1.x** (faster than Jest)
- Coverage provider: **v8**
- Coverage thresholds: 80% lines, 80% functions, 75% branches, 80% statements
- Test file patterns: `**/*.{test,spec}.{ts,tsx}`

### Story-Specific Testing Requirements
For Story 1.1, verify:
1. All packages build without errors: `pnpm build`
2. Linting passes: `pnpm lint`
3. Type checking passes: `pnpm typecheck`
4. Husky hooks are executable
5. pnpm workspace resolution works correctly

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-01 | 1.0 | Initial story draft | Bob (SM Agent) |

---

## Dev Agent Record

### Agent Model Used
*To be filled by Dev Agent*

### Debug Log References
*To be filled by Dev Agent*

### Completion Notes List
*To be filled by Dev Agent*

### File List
*To be filled by Dev Agent*

---

## QA Results
*To be filled by QA Agent*

